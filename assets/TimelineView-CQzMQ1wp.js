import{B as D,r as y,d as g,f as S,c as o,a as l,_ as E,o as j,g as u,F as v,b as _,t as C,h as F,n as O,u as h,i as B,G as T,j as P,k as V}from"./index-DX1WmWX1.js";const w={__name:"AddGoalFromTimeline",props:{baseGoalProps:Object,backend:{type:Object,default:D.getBackend()}},emits:["create"],setup(p,{emit:d}){const f=p,n=d,G=()=>({...f.baseGoalProps,children:void 0,title:"new goal"}),c=y(!1),m=y(void 0);function k(){c.value=!0,m.value=G()}function a(t){t&&(n("create",t),f.backend.create(t).then(e=>t.id=e.id)),c.value=!1}return(t,e)=>c.value?(l(),g(S,{key:0,onDoneEdit:a,model:m.value},null,8,["model"])):(l(),o("div",{key:1,class:"startCreate",onDblclick:k,role:"button",id:"add"},"+",32))}},L={class:"category"},N={class:"hint"},$={__name:"GoalsTimeline",props:{initGoals:{type:Array,default(){return[{title:"Week",goals:[]},{title:"Month",goals:[]}]}},backend:Object},setup(p){const d=p,f=y(void 0),n=y(void 0),G=V,c=a=>new Date((Date.parse(a==null?void 0:a.end)||Date.now())-1).toISOString().split("T")[0];function m(a,t,e,s){let r=a[e],i=r.goals.findIndex(({id:M})=>M==t.id);r.goals.splice(i,1);let b=a[s];t.targetDate=c(b),b.goals.push(t),d.backend.updateGoal(t)}function k(a,t,e){switch(t){case"right":e<n.value.length-1&&m(n.value,a,e,e+1);break;case"left":e>0&&m(n.value,a,e,e-1);break;default:console.error("Unsupported direction: ",t)}}return j(async()=>{var a,t;try{n.value=(a=d.backend)!=null&&a.getTimeline?await d.backend.getTimeline():d.initGoals,(t=n.value)==null||t.forEach(e=>e.id=Math.random())}catch(e){console.error(e)}}),(a,t)=>(l(),o("table",null,[u("thead",null,[u("tr",null,[t[0]||(t[0]=u("th",{class:"category"},null,-1)),(l(!0),o(v,null,_(n.value,e=>(l(),o("th",{key:e.title},C(e.title),1))),128))])]),u("tbody",null,[(l(!0),o(v,null,_(h(G),e=>(l(),o("tr",{key:e.title},[u("td",L,[F(C(e.title),1),t[1]||(t[1]=u("br",null,null,-1)),u("span",N,C(e.hint),1)]),(l(!0),o(v,null,_(n.value,(s,r)=>(l(),o("td",{class:O(["goals",f.value==s.title+e.title?"focused":""]),key:s.id},[(l(),g(T,{initGoals:s.goals.filter(i=>h(B)(i.tags)==e.title),key:s.goals.length,moveConfig:{mode:"timeline",onMove:({goal:i,direction:b})=>k(i,b,r)}},null,8,["initGoals","moveConfig"])),r!=n.value.length-1?(l(),g(w,{key:0,baseGoalProps:{tags:[e.title],targetDate:c(s)},onCreate:i=>s.goals.push(i)},null,8,["baseGoalProps","onCreate"])):P("",!0)],2))),128))]))),128)),u("tr",null,[t[2]||(t[2]=u("td",{class:"category"},null,-1)),(l(!0),o(v,null,_(n.value,(e,s)=>(l(),o("td",{class:"goals",key:e.id},[(l(),g(T,{initGoals:e.goals.filter(r=>!h(B)(r.tags)),key:e.goals.length,moveConfig:{mode:"timeline",onMove:({goal:r,direction:i})=>k(r,i,s)}},null,8,["initGoals","moveConfig"]))]))),128))])])]))}},x=E($,[["__scopeId","data-v-7d9ce3eb"]]),z={__name:"TimelineView",setup(p){const d=D.getBackend();return(f,n)=>(l(),g(x,{backend:h(d)},null,8,["backend"]))}};export{z as default};
